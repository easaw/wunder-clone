<div class="app-container group">
  
  <section class="sidebar">  
    <%= render partial: "users/nav" %>
    
    <nav id="lists-index"></nav>
  </section>

  <div id="content-container" class="group">
    <section id="content">
    </section>
    <section id="side-content"></section>
  </div>
  
  <div id="modal-container">
  </div>
  
</div>

<script src="//js.pusher.com/2.2/pusher.min.js" type="text/javascript"></script>
<script>

$(document).ready(function(){
  if(<%= signed_in? %>){
   window.currentUserId = <%= current_user.id %>; 
    Wunderclone.otherUsers = {};
    $.getJSON("api/users", function(data){
      data.forEach(function(user_data){
        Wunderclone.otherUsers[user_data['email']] = user_data['id'];
      })
    });
  
    var pusher = new Pusher('<%= ENV["PUSHER_KEY"] %>');
    var channel = pusher.subscribe('notifications-' + <%= current_user.id %>);
    channel.bind('new', function(data){
      list = new Wunderclone.Models.List(data.list_data.json);
      Wunderclone.Collections.lists.add(list);
      Wunderclone.Collections.notifications.fetch();
    })
  
    channel.bind('update', function(data){
      list_data = data.list_data.json;
      list_id = list_data.id;
      list = Wunderclone.Collections.lists.get(list_id);
      list.save(list_data);
      
      // Wunderclone.Collections.lists.fetch();
      // Wunderclone.Collections.notifications.fetch();
    })
  
    channel.bind('destroy', function(data){
      Wunderclone.Collections.lists.remove(data.list_id);
      // Wunderclone.Collections.notifications.fetch();
    })
    
    channel.bind('new-shared-task', function(data){
      task = new Wunderclone.Models.Task(data.task_data.json);
      list_id = task.attributes.list_id;
      list = Wunderclone.Collections.lists.get(list_id);
      list.activeTasks().add(task);
      // Wunderclone.Collections.notifications.fetch();
    })
  }
});


</script>